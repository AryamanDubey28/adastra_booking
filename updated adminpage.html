<!DOCTYPE html>
<html>

<head>
  <title>Admin Page</title>
  <style>
    th,
    td {
      border: 1px solid black;
      text-align: center;
    }
  </style>

  <!-- <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> -->
  <link rel="stylesheet" href="admin_style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>

<body>

  <h2>Booking Requests</h2>
  <h3>Test Assessments</h3>
  <h4>Requests</h4>

  <div id="testAssessmentTableContainer">
    <table id="testAssessmentTable"></table>

    <input id="testAssessmentRow" placeholder="Row"><br>
    <button id="testAssessmentAcceptButton">Accept</button>
    <button id="testAssessmentRejectButton">Reject</button>
    <p id="testAssessmentButtonText" style="margin-top: 0; color:red"></p>
  </div>

  <p id="testAssessmentTableText" style="margin-top: 0"></p>

  <h4>Accepted</h4>

  <div id="testAssessmentChangeTableContainer">
    <table id="testAssessmentChangeTable"></table>

    <input id="testAssessmentChangeRow" placeholder="Row"><br>
    <button id="testAssessmentChangeButton">Change to Reject</button>
    <p id="testAssessmentChangeButtonText" style="margin-top: 0; color:red"></p>
  </div>

  <p id="testAssessmentChangeTableText" style="margin-top: 0"></p>


  <h3>Crash Courses</h3>
  <h4>Requests</h4>

  <div id="crashCourseTableContainer">
    <table id="crashCourseTable"></table>

    <input id="crashCourseRow" placeholder="Row"><br>
    <button id="crashCourseAcceptButton">Accept</button>
    <button id="crashCourseRejectButton">Reject</button>
    <p id="crashCourseButtonText" style="margin-top: 0; color:red"></p>
  </div>

  <p id="crashCourseTableText" style="margin-top: 0"></p>

  <h4>Accepted</h4>

  <div id="crashCourseChangeTableContainer">
    <table id="crashCourseChangeTable"></table>

    <input id="crashCourseChangeRow" placeholder="Row"><br>
    <button id="crashCourseChangeButton">Change to Reject</button>
    <p id="crashCourseChangeButtonText" style="margin-top: 0; color:red"></p>
  </div>

  <p id="crashCourseChangeTableText" style="margin-top: 0"></p>

  <h2>Add Available Booking</h2>
  <h3>Test Assessments</h3>
  <h4>Single Booking</h4>

  <div id="testAssessmentCreateBookingContainer">
    <label for="testAssessmentDate">Date:</label>
    <input type="date" id="testAssessmentDate"><br>
    <p id="testAssessmentDateText" style="margin-top: 0; color:red"></p>
    <label for="testAssessmentTime">Time (e.g. 14:00):</label>
    <input type="text" id="testAssessmentTime"><br>
    <p id="testAssessmentTimeText" style="margin-top: 0; color:red"></p>
    <label for="testAssessmentLocation">Location:</label>
    <select id="testAssessmentLocation"></select><br><br>

    <script>
      // Your list of options
      var testAssessmentOptionsList = ["Burnham Centre", "Royal Grammar School"];

      // Get the select element by its ID
      var testAssessmentSelectElement = document.getElementById("testAssessmentLocation");

      // Loop through the optionsList and create an <option> element for each item
      for (var i = 0; i < testAssessmentOptionsList.length; i++) {
        var option = document.createElement("option");
        option.value = testAssessmentOptionsList[i]; // Set the value for each option
        option.text = testAssessmentOptionsList[i];  // Set the text for each option
        testAssessmentSelectElement.appendChild(option); // Append the option to the select element
      }
    </script>

    <button id="testAssessmentCreateBookingButton">Create Booking</button>
  </div>

  <p id="testAssessmentResultText"></p>

  <h4>List of Bookings</h4>
  <p>Insert a list in the following format:<br><br>
    Date Time Location<br><br>
    e.g.<br>
    14-11-2023 12:00 Royal Grammar School<br>
    14-11-2023 16:00 Burnham Centre<br>
    15-11-2023 13:00 Burnham Centre
  </p>

  <textarea id="testAssessmentList" cols="40" rows="5"></textarea><br>
  <button id="testAssessmentAddListButton">Add List</button>
  <p id="testAssessmentAddListText" style="margin-top: 0; color:red"></p>

  <h3>Crash Courses</h3>
  <h4>Single Booking</h4>

  <div id="crashCourseCreateBookingContainer">
    <label for="crashCourseDate">Date:</label>
    <input type="date" id="crashCourseDate"><br>
    <p id="crashCourseDateText" style="margin-top: 0; color:red"></p>
    <label for="crashCourseTime">Time (e.g. 14:00):</label>
    <input type="text" id="crashCourseTime"><br>
    <p id="crashCourseTimeText" style="margin-top: 0; color:red"></p>
    <label for="crashCourseLocation">Location:</label>
    <select id="crashCourseLocation"></select><br><br>

    <script>
      // Your list of options
      var crashCourseOptionsList = ["Burnham Centre"];

      // Get the select element by its ID
      var crashCourseSelectElement = document.getElementById("crashCourseLocation");

      // Loop through the optionsList and create an <option> element for each item
      for (var i = 0; i < crashCourseOptionsList.length; i++) {
        var option = document.createElement("option");
        option.value = crashCourseOptionsList[i]; // Set the value for each option
        option.text = crashCourseOptionsList[i];  // Set the text for each option
        crashCourseSelectElement.appendChild(option); // Append the option to the select element
      }
    </script>

    <button id="crashCourseCreateBookingButton">Create Booking</button>
  </div>

  <p id="crashCourseResultText"></p>

  <h4>List of Bookings</h4>
  <p>Insert a list in the following format:<br><br>
    Date Time Location<br><br>
    e.g.<br>
    14-11-2023 12:00 London<br>
    14-11-2023 16:00 London<br>
    15-11-2023 13:00 Paris
  </p>

  <textarea id="crashCourseList" cols="40" rows="5"></textarea><br>
  <button id="crashCourseAddListButton">Add List</button>
  <p id="crashCourseAddListText" style="margin-top: 0; color:red"></p>


  <script type="module">
    // Importing
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
    import { getDatabase, ref, get, set, child, update, remove }
      from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js"

    // Functions

    // Function to reformat the date because the date input gives it in the wrong format
    function formatDateFromInput(inputString) {
      var parts = inputString.split("-");
      var date = parts[2] + "-" + parts[1] + "-" + parts[0];
      return date;
    }

    // Function to sort items by their centre
    function sortItems(a, b) {
      var itemA = a[5].toUpperCase(); // 5 represnts that the location is the 6th element in each 
      var itemB = b[5].toUpperCase();

      if (itemA < itemB) {
        return -1;
      }
      if (itemA > itemB) {
        return 1;
      }

      return 0;
    }

    // Function to convert the location into the format it is stored as in the title of the booking
    function replaceSpacesWithHyphens(inputString) {
      return inputString.replace(/ /g, "-");
    }

    function testAssessmentAcceptBooking() {
      var row = document.getElementById("testAssessmentRow").value;

      // If a valid row is entered then accept the request on that row
      if (row === "" || parseInt(row) > testAssessmentRequests.length - 1 || parseInt(row) == 0) {
        testAssessmentButtonTextElement.textContent = "Please enter a valid row";
      } else {
        // Remove existing error messages
        testAssessmentButtonTextElement.textContent = "";

        // Update the database
        var firstName = testAssessmentRequests[row][0];
        var lastName = testAssessmentRequests[row][1];
        var email = testAssessmentRequests[row][2];
        var phoneNumber = testAssessmentRequests[row][3];
        var comment = testAssessmentRequests[row][4];
        var location = testAssessmentRequests[row][5];
        var date = testAssessmentRequests[row][6];
        var time = testAssessmentRequests[row][7];

        set(ref(db, "test-assessments/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
          "first-name": firstName,
          "last-name": lastName,
          "email": email,
          "phone-number": phoneNumber,
          "comment": comment,
          "status": "accepted",
          "location": location,
          "date": date,
          "time": time
        })

        // Set the row green
        var rows = document.querySelectorAll("#testAssessmentTable tr");

        var rowCells = rows[row].querySelectorAll("td");
        rowCells.forEach(function (cell) {
          cell.style.color = "green";
          cell.style.fontWeight = "bold";
        });

        // Clear the row input
        document.getElementById("testAssessmentRow").value = "";

        // Compose an email
        var subject = "Test Assessment Response";
        var body = "Hi " + firstName + ",\n\nYour request for a booking on " + date + " at " + time + " in " + location + " has been accepted. We look forward to seeing you.\n\nRegards,\nAd Astra Tuition";

        var mailtoURL = "mailto:" + encodeURIComponent(email) +
          "?subject=" + encodeURIComponent(subject) +
          "&body=" + encodeURIComponent(body);

        window.open(mailtoURL);
      }
    }

    function crashCourseAcceptBooking() {
      var row = document.getElementById("crashCourseRow").value;

      // If a valid row is entered then accept the request on that row
      if (row === "" || parseInt(row) > crashCourseRequests.length - 1 || parseInt(row) == 0) {
        crashCourseButtonTextElement.textContent = "Please enter a valid row";
      } else {
        // Remove existing error messages
        crashCourseButtonTextElement.textContent = "";

        // Update the database
        var firstName = crashCourseRequests[row][0];
        var lastName = crashCourseRequests[row][1];
        var email = crashCourseRequests[row][2];
        var phoneNumber = crashCourseRequests[row][3];
        var comment = crashCourseRequests[row][4];
        var location = crashCourseRequests[row][5];
        var date = crashCourseRequests[row][6];
        var time = crashCourseRequests[row][7];

        set(ref(db, "crash-courses/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
          "first-name": firstName,
          "last-name": lastName,
          "email": email,
          "phone-number": phoneNumber,
          "comment": comment,
          "status": "accepted",
          "location": location,
          "date": date,
          "time": time
        })

        // Set the row green
        var rows = document.querySelectorAll("#crashCourseTable tr");

        var rowCells = rows[row].querySelectorAll("td");
        rowCells.forEach(function (cell) {
          cell.style.color = "green";
          cell.style.fontWeight = "bold";
        });

        // Clear the row input
        document.getElementById("crashCourseRow").value = "";

        // Compose an email
        var subject = "Crash Course Response";
        var body = "Hi " + firstName + ",\n\nYour request for a booking on " + date + " at " + time + " in " + location + " has been accepted. We look forward to seeing you.\n\nRegards,\nAd Astra Tuition";

        var mailtoURL = "mailto:" + encodeURIComponent(email) +
          "?subject=" + encodeURIComponent(subject) +
          "&body=" + encodeURIComponent(body);

        window.open(mailtoURL);
      }
    }

    function testAssessmentRejectBooking() {
      var row = document.getElementById("testAssessmentRow").value;

      // If a valid row is entered then reject the request on that row
      if (row === "" || parseInt(row) > testAssessmentRequests.length - 1 || parseInt(row) == 0) {
        testAssessmentButtonTextElement.textContent = "Please enter a valid row";
      } else {
        // Remove existing error messages
        testAssessmentButtonTextElement.textContent = "";

        // Update the database
        var location = testAssessmentRequests[row][5];
        var date = testAssessmentRequests[row][6];
        var time = testAssessmentRequests[row][7];

        set(ref(db, "test-assessments/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
          "status": "available",
          "location": location,
          "date": date,
          "time": time
        })

        // Set the row red
        var rows = document.querySelectorAll("#testAssessmentTable tr");

        var rowCells = rows[row].querySelectorAll("td");
        rowCells.forEach(function (cell) {
          cell.style.color = "red";
          cell.style.fontWeight = "bold";
        });

        // Clear the row input
        document.getElementById("testAssessmentRow").value = "";

        // Compose an email
        var firstName = testAssessmentRequests[row][0];
        var email = testAssessmentRequests[row][2];

        var subject = "Test Assessment Response";
        var body = "Hi " + firstName + ",\n\nUnfortunately, your request for a booking on " + date + " at " + time + " in " + location + " has been rejected. Please try and request another time.\n\nRegards,\nAd Astra";

        var mailtoURL = "mailto:" + encodeURIComponent(email) +
          "?subject=" + encodeURIComponent(subject) +
          "&body=" + encodeURIComponent(body);

        window.open(mailtoURL);
      }
    }

    function testAssessmentChangeToRejectBooking() {
      var row = document.getElementById("testAssessmentChangeRow").value;

      // If a valid row is entered then reject the request on that row
      if (row === "" || parseInt(row) > testAssessmentAccepted.length - 1 || parseInt(row) == 0) {
        testAssessmentChangeButtonTextElement.textContent = "Please enter a valid row";
      } else {
        // Remove existing error messages
        testAssessmentChangeButtonTextElement.textContent = "";

        // Update the database
        var location = testAssessmentAccepted[row][5];
        var date = testAssessmentAccepted[row][6];
        var time = testAssessmentAccepted[row][7];

        set(ref(db, "test-assessments/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
          "status": "available",
          "location": location,
          "date": date,
          "time": time
        })

        // Set the row red
        var rows = document.querySelectorAll("#testAssessmentChangeTable tr");

        var rowCells = rows[row].querySelectorAll("td");
        rowCells.forEach(function (cell) {
          cell.style.color = "red";
          cell.style.fontWeight = "bold";
        });

        // Clear the row input
        document.getElementById("testAssessmentRow").value = "";

        // Compose an email
        var firstName = testAssessmentAccepted[row][0];
        var email = testAssessmentAccepted[row][2];

        var subject = "Test Assessment Change";
        var body = "Hi " + firstName + ",\n\nWe are very sorry to inform you that your booking on " + date + " at " + time + " in " + location + " has been changed from accepted to rejected. Please try and request another time.\n\nRegards,\nAd Astra";

        var mailtoURL = "mailto:" + encodeURIComponent(email) +
          "?subject=" + encodeURIComponent(subject) +
          "&body=" + encodeURIComponent(body);

        window.open(mailtoURL);
      }
    }

    function crashCourseRejectBooking() {
      var row = document.getElementById("crashCourseRow").value;

      // If a valid row is entered then reject the request on that row
      if (row === "" || parseInt(row) > crashCourseRequests.length - 1 || parseInt(row) == 0) {
        crashCourseButtonTextElement.textContent = "Please enter a valid row";
      } else {
        // Remove existing error messages
        crashCourseButtonTextElement.textContent = "";

        // Update the database
        var location = crashCourseRequests[row][5];
        var date = crashCourseRequests[row][6];
        var time = crashCourseRequests[row][7];

        set(ref(db, "crash-courses/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
          "status": "available",
          "location": location,
          "date": date,
          "time": time
        })

        // Set the row red
        var rows = document.querySelectorAll("#crashCourseTable tr");

        var rowCells = rows[row].querySelectorAll("td");
        rowCells.forEach(function (cell) {
          cell.style.color = "red";
          cell.style.fontWeight = "bold";
        });

        // Clear the row input
        document.getElementById("crashCourseRow").value = "";

        // Compose an email
        var firstName = crashCourseRequests[row][0];
        var email = crashCourseRequests[row][2];

        var subject = "Crash Course Response";
        var body = "Hi " + firstName + ",\n\nUnfortunately, your request for a booking on " + date + " at " + time + " in " + location + " has been rejected. Please try and request another time.\n\nRegards,\nAd Astra";

        var mailtoURL = "mailto:" + encodeURIComponent(email) +
          "?subject=" + encodeURIComponent(subject) +
          "&body=" + encodeURIComponent(body);

        window.open(mailtoURL);
      }
    }

    function crashCourseChangeToRejectBooking() {
      var row = document.getElementById("crashCourseChangeRow").value;

      // If a valid row is entered then reject the request on that row
      if (row === "" || parseInt(row) > crashCourseAccepted.length - 1 || parseInt(row) == 0) {
        crashCourseChangeButtonTextElement.textContent = "Please enter a valid row";
      } else {
        // Remove existing error messages
        crashCourseChangeButtonTextElement.textContent = "";

        // Update the database
        var location = crashCourseAccepted[row][5];
        var date = crashCourseAccepted[row][6];
        var time = crashCourseAccepted[row][7];

        set(ref(db, "crash-courses/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
          "status": "available",
          "location": location,
          "date": date,
          "time": time
        })

        // Set the row red
        var rows = document.querySelectorAll("#crashCourseChangeTable tr");

        var rowCells = rows[row].querySelectorAll("td");
        rowCells.forEach(function (cell) {
          cell.style.color = "red";
          cell.style.fontWeight = "bold";
        });

        // Clear the row input
        document.getElementById("crashCourseRow").value = "";

        // Compose an email
        var firstName = crashCourseAccepted[row][0];
        var email = crashCourseAccepted[row][2];

        var subject = "Crash Course Change";
        var body = "Hi " + firstName + ",\n\nWe are very sorry to inform you that your booking on " + date + " at " + time + " in " + location + " has been changed from accepted to rejected. Please try and request another time.\n\nRegards,\nAd Astra";

        var mailtoURL = "mailto:" + encodeURIComponent(email) +
          "?subject=" + encodeURIComponent(subject) +
          "&body=" + encodeURIComponent(body);

        window.open(mailtoURL);
      }
    }

    function testAssessmentInsertBooking() {
      var date = formatDateFromInput(document.getElementById("testAssessmentDate").value);
      var time = document.getElementById("testAssessmentTime").value;
      var location = document.getElementById("testAssessmentLocation").value;

      set(ref(db, "test-assessments/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
        "status": "available",
        "location": location,
        "date": date,
        "time": time
      })

      testAssessmentResultTextElement.style.color = "green";
      testAssessmentResultTextElement.textContent = "Added available test assessment booking on " + date + " at " + time + " in " + location + ".";
      document.getElementById("testAssessmentTime").value = "";
    }

    function crashCourseInsertBooking() {
      var date = formatDateFromInput(document.getElementById("crashCourseDate").value);
      var time = document.getElementById("crashCourseTime").value;
      var location = document.getElementById("crashCourseLocation").value;

      set(ref(db, "crash-courses/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
        "status": "available",
        "location": location,
        "date": date,
        "time": time
      })

      crashCourseResultTextElement.style.color = "green";
      crashCourseResultTextElement.textContent = "Added available crash course booking on " + date + " at " + time + " in " + location + ".";
      document.getElementById("crashCourseTime").value = "";
    }

    function testAssessmentProcessInputs() {
      var allInfoFilledCorrectly = true;

      var unformattedDate = document.getElementById("testAssessmentDate").value;
      var parts = unformattedDate.split("-");
      var date = parts[2] + "-" + parts[1] + "-" + parts[0];

      if (date === "") {
        testAssessmentDateTextElement.textContent = "Please select a date";
        allInfoFilledCorrectly = false;
      } else {
        testAssessmentDateTextElement.textContent = "";
      }

      var time = document.getElementById("testAssessmentTime").value;

      if (time === "") {
        timeTextElement.textContent = "Please enter a time";
        allInfoFilledCorrectly = false;
      } else {
        testAssessmentTimeTextElement.textContent = "";
      }

      if (allInfoFilledCorrectly === true) {
        testAssessmentInsertBooking();
      } else {
        testAssessmentResultTextElement.textContent = "";
      }
    }

    function testAssessmentAddList() {
      var inputText = document.getElementById('testAssessmentList').value;
      var lines = inputText.split('\n');
      var pattern = /^\d{2}-\d{2}-\d{4} \d{2}:\d{2} .+$/;
      var linesGood = true
      var linesWithProblem = []

      for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        if (pattern.test(line) == false) {
          linesGood = false;
          var lineNumber = i + 1;
          var lineNumberStr = lineNumber.toString();
          var lineNumberAndErrorReason = lineNumberStr.concat(" (incorrect date/time format)");
          linesWithProblem.push(lineNumberAndErrorReason);
        } else {
          var parts = line.split(' ');

          var location = "";

          for (var j = 2; j < parts.length; j++) {
            if (j > 2 && parts[j].length > 0) {
              location = location.concat(" ");
            }
            location = location.concat(parts[j]);
          }

          if (!testAssessmentOptionsList.includes(location)){
            linesGood = false;
          var lineNumber = i + 1;
          var lineNumberStr = lineNumber.toString();
          var lineNumberAndErrorReason = lineNumberStr.concat(" (location typo/not in list)");
          linesWithProblem.push(lineNumberAndErrorReason);
          }
        }
      }

      if (linesGood == true) {
        for (var i = 0; i < lines.length; i++) {
          var line = lines[i];
          var parts = line.split(' ');

          var date = parts[0];
          var time = parts[1];
          var location = "";

          for (var j = 2; j < parts.length; j++) {
            if (j > 2 && parts[j].length > 0) {
              location = location.concat(" ");
            }
            location = location.concat(parts[j]);
          }

          set(ref(db, "test-assessments/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
            "status": "available",
            "location": location,
            "date": date,
            "time": time
          })
        }

        testAssessmentAddListTextElement.style.color = "green";
        testAssessmentAddListTextElement.textContent = "Added new test assessment bookings.";
        document.getElementById("testAssessmentList").value = "";
      } else {
        testAssessmentAddListTextElement.style.color = "red";
        var errorMessage = "Error on lines: "
        for (var i = 0; i < linesWithProblem.length; i++) {
          errorMessage = errorMessage.concat(linesWithProblem[i])
          if (i < linesWithProblem.length - 1) {
            errorMessage = errorMessage.concat(", ")
          } else {
            errorMessage = errorMessage.concat(".")
          }
        }
        testAssessmentAddListTextElement.textContent = errorMessage;
      }
    }

    function crashCourseProcessInputs() {
      var allInfoFilledCorrectly = true;

      var unformattedDate = document.getElementById("crashCourseDate").value;
      var parts = unformattedDate.split("-");
      var date = parts[2] + "-" + parts[1] + "-" + parts[0];

      if (date === "") {
        crashCourseDateTextElement.textContent = "Please select a date";
        allInfoFilledCorrectly = false;
      } else {
        crashCourseDateTextElement.textContent = "";
      }

      var time = document.getElementById("crashCourseTime").value;

      if (time === "") {
        timeTextElement.textContent = "Please enter a time";
        allInfoFilledCorrectly = false;
      } else {
        crashCourseTimeTextElement.textContent = "";
      }

      if (allInfoFilledCorrectly === true) {
        crashCourseInsertBooking();
      } else {
        crashCourseResultTextElement.textContent = "";
      }
    }

    function crashCourseAddList() {
      var inputText = document.getElementById('crashCourseList').value;
      var lines = inputText.split('\n');
      var pattern = /^\d{2}-\d{2}-\d{4} \d{2}:\d{2} .+$/;
      var linesGood = true
      var linesWithProblem = []

      for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        if (pattern.test(line) == false) {
          linesGood = false;
          var lineNumber = i + 1;
          var lineNumberStr = lineNumber.toString();
          var lineNumberAndErrorReason = lineNumberStr.concat(" (incorrect date/time format)");
          linesWithProblem.push(lineNumberAndErrorReason);
        } else {
          var parts = line.split(' ');

          var location = "";

          for (var j = 2; j < parts.length; j++) {
            if (j > 2 && parts[j].length > 0) {
              location = location.concat(" ");
            }
            location = location.concat(parts[j]);
          }

          if (!crashCourseOptionsList.includes(location)){
            linesGood = false;
          var lineNumber = i + 1;
          var lineNumberStr = lineNumber.toString();
          var lineNumberAndErrorReason = lineNumberStr.concat(" (location typo/not in list)");
          linesWithProblem.push(lineNumberAndErrorReason);
          }
        }
      }

      if (linesGood == true) {
        for (var i = 0; i < lines.length; i++) {
          var line = lines[i];
          var parts = line.split(' ');

          var date = parts[0];
          var time = parts[1];
          var location = "";

          for (var j = 2; j < parts.length; j++) {
            if (j > 2 && parts[j].length > 0) {
              location = location.concat(" ");
            }
            location = location.concat(parts[j]);
          }

          set(ref(db, "crash-courses/" + date + ";" + time + ";" + replaceSpacesWithHyphens(location)), {
            "status": "available",
            "location": location,
            "date": date,
            "time": time
          })
        }

        crashCourseAddListTextElement.style.color = "green";
        crashCourseAddListTextElement.textContent = "Added new crash course bookings.";
        document.getElementById("crashCourseList").value = "";
      } else {
        crashCourseAddListTextElement.style.color = "red";
        var errorMessage = "Error on lines: "
        for (var i = 0; i < linesWithProblem.length; i++) {
          errorMessage = errorMessage.concat(linesWithProblem[i])
          if (i < linesWithProblem.length - 1) {
            errorMessage = errorMessage.concat(", ")
          } else {
            errorMessage = errorMessage.concat(".")
          }
        }
        crashCourseAddListTextElement.textContent = errorMessage;
      }
    }

    // Create all of the variables which will be accessed by function
    var testAssessmentTableContainerElement = document.getElementById("testAssessmentTableContainer")
    var testAssessmentTableElement = document.getElementById("testAssessmentTable");
    var testAssessmentTableTextElement = document.getElementById("testAssessmentTableText");
    var testAssessmentAcceptButton = document.getElementById("testAssessmentAcceptButton");
    var testAssessmentRejectButton = document.getElementById("testAssessmentRejectButton");
    var testAssessmentButtonTextElement = document.getElementById("testAssessmentButtonText");

    var testAssessmentChangeTableContainerElement = document.getElementById("testAssessmentChangeTableContainer")
    var testAssessmentChangeTableElement = document.getElementById("testAssessmentChangeTable");
    var testAssessmentChangeTableTextElement = document.getElementById("testAssessmentChangeTableText");
    var testAssessmentChangeButton = document.getElementById("testAssessmentChangeButton");
    var testAssessmentChangeButtonTextElement = document.getElementById("testAssessmentChangeButtonText");

    var crashCourseTableContainerElement = document.getElementById("crashCourseTableContainer")
    var crashCourseTableElement = document.getElementById("crashCourseTable");
    var crashCourseTableTextElement = document.getElementById("crashCourseTableText");
    var crashCourseAcceptButton = document.getElementById("crashCourseAcceptButton");
    var crashCourseRejectButton = document.getElementById("crashCourseRejectButton");
    var crashCourseButtonTextElement = document.getElementById("crashCourseButtonText");

    var crashCourseChangeTableContainerElement = document.getElementById("crashCourseChangeTableContainer")
    var crashCourseChangeTableElement = document.getElementById("crashCourseChangeTable");
    var crashCourseChangeTableTextElement = document.getElementById("crashCourseChangeTableText");
    var crashCourseChangeButton = document.getElementById("crashCourseChangeButton");
    var crashCourseChangeButtonTextElement = document.getElementById("crashCourseChangeButtonText");

    var testAssessmentDateTextElement = document.getElementById("testAssessmentDateText");
    var testAssessmentTimeTextElement = document.getElementById("testAssessmentTimeText");
    var testAssessmentLocationTextElement = document.getElementById("testAssessmentLocationText");
    var testAssessmentCreateBookingButton = document.getElementById("testAssessmentCreateBookingButton");
    var testAssessmentResultTextElement = document.getElementById("testAssessmentResultText");

    var testAssessmentAddListButtonElement = document.getElementById('testAssessmentAddListButton');
    var testAssessmentAddListTextElement = document.getElementById('testAssessmentAddListText');

    var crashCourseDateTextElement = document.getElementById("crashCourseDateText");
    var crashCourseTimeTextElement = document.getElementById("crashCourseTimeText");
    var crashCourseLocationTextElement = document.getElementById("crashCourseLocationText");
    var crashCourseCreateBookingButton = document.getElementById("crashCourseCreateBookingButton");
    var crashCourseResultTextElement = document.getElementById("crashCourseResultText");

    var crashCourseAddListButtonElement = document.getElementById('crashCourseAddListButton');
    var crashCourseAddListTextElement = document.getElementById('crashCourseAddListText');

    // Access the database
    var firebaseConfig = {
      apiKey: "AIzaSyCbo5IPc1TL0rKKcG16BYBI2bRueYof8rc",
      authDomain: "ad-astra-test1.firebaseapp.com",
      databaseURL: "https://ad-astra-test1-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "ad-astra-test1",
      storageBucket: "ad-astra-test1.appspot.com",
      messagingSenderId: "754196429203",
      appId: "1:754196429203:web:e192d5608e0c3ef1005066"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const dbref = ref(db);

    // Fill the test assessment table with the requested bookings
    var tempTestAssessmentRequests = [];

    var testAssessmentRequests = [
      ["First Name", "Last Name", "Email", "Phone Number", "Comment", "Location", "Date", "Time", "Row"]
    ];

    var tempTestAssessmentAccepted = [];

    var testAssessmentAccepted = [
      ["First Name", "Last Name", "Email", "Phone Number", "Comment", "Location", "Date", "Time", "Row"]
    ];

    get(child(dbref, "test-assessments/"))
      .then((snapshot) => {
        snapshot.forEach(child => {
          if (child.val().status == "requested") {
            var firstName = child.val()["first-name"];
            var lastName = child.val()["last-name"];
            var email = child.val().email;
            var phoneNumber = child.val()["phone-number"];
            var comment = child.val().comment;
            var location = child.val().location;
            var date = child.val().date;
            var time = child.val().time;

            tempTestAssessmentRequests.push([firstName, lastName, email, phoneNumber, comment, location, date, time])
          } else if (child.val().status == "accepted") {
            var firstName = child.val()["first-name"];
            var lastName = child.val()["last-name"];
            var email = child.val().email;
            var phoneNumber = child.val()["phone-number"];
            var comment = child.val().comment;
            var location = child.val().location;
            var date = child.val().date;
            var time = child.val().time;

            tempTestAssessmentAccepted.push([firstName, lastName, email, phoneNumber, comment, location, date, time])
          }
        });

        tempTestAssessmentRequests.sort(sortItems);

        for (var i = 0; i < tempTestAssessmentRequests.length; i++) {
          testAssessmentRequests.push(tempTestAssessmentRequests[i])
        }

        tempTestAssessmentAccepted.sort(sortItems);

        for (var i = 0; i < tempTestAssessmentAccepted.length; i++) {
          testAssessmentAccepted.push(tempTestAssessmentAccepted[i])
        }

        // If requests exist then create the table showing all their details and set up the buttons
        if (testAssessmentRequests.length > 1) {
          // Create table rows and cells from the 2D array
          for (var i = 0; i < testAssessmentRequests.length; i++) {
            var row = testAssessmentTableElement.insertRow();
            for (var j = 0; j < testAssessmentRequests[0].length; j++) {
              var cell = row.insertCell();
              if (j != testAssessmentRequests[0].length - 1 || i == 0) {
                cell.innerHTML = testAssessmentRequests[i][j];
              } else {
                cell.innerHTML = i;
              }
            }
          }
        } else {
          testAssessmentTableContainerElement.style.display = "none";
          testAssessmentTableTextElement.textContent = "No booking requests";
        }

        // If accepted bookings exist then create the table showing all their details and set up the buttons
        if (testAssessmentAccepted.length > 1) {
          // Create table rows and cells from the 2D array
          for (var i = 0; i < testAssessmentAccepted.length; i++) {
            var row = testAssessmentChangeTableElement.insertRow();
            for (var j = 0; j < testAssessmentAccepted[0].length; j++) {
              var cell = row.insertCell();
              if (j != testAssessmentAccepted[0].length - 1 || i == 0) {
                cell.innerHTML = testAssessmentAccepted[i][j];
              } else {
                cell.innerHTML = i;
              }
            }
          }
        } else {
          testAssessmentChangeTableContainerElement.style.display = "none";
          testAssessmentChangeTableTextElement.textContent = "No accepted bookings coming up";
        }
      })

    // Fill the crash course table with the requested bookings

    var tempCrashCourseRequests = [];

    var crashCourseRequests = [
      ["First Name", "Last Name", "Email", "Phone Number", "Comment", "Location", "Date", "Time", "Row"]
    ];

    var tempCrashCourseAccepted = [];

    var crashCourseAccepted = [
      ["First Name", "Last Name", "Email", "Phone Number", "Comment", "Location", "Date", "Time", "Row"]
    ];

    get(child(dbref, "crash-courses/"))
      .then((snapshot) => {
        snapshot.forEach(child => {
          if (child.val().status == "requested") {
            var firstName = child.val()["first-name"];
            var lastName = child.val()["last-name"];
            var email = child.val().email;
            var phoneNumber = child.val()["phone-number"];
            var comment = child.val().comment;
            var location = child.val().location;
            var date = child.val().date;
            var time = child.val().time;

            tempCrashCourseRequests.push([firstName, lastName, email, phoneNumber, comment, location, date, time])
          } else if (child.val().status == "accepted") {
            var firstName = child.val()["first-name"];
            var lastName = child.val()["last-name"];
            var email = child.val().email;
            var phoneNumber = child.val()["phone-number"];
            var comment = child.val().comment;
            var location = child.val().location;
            var date = child.val().date;
            var time = child.val().time;

            tempCrashCourseAccepted.push([firstName, lastName, email, phoneNumber, comment, location, date, time])
          }
        });

        tempCrashCourseRequests.sort(sortItems);

        for (var i = 0; i < tempCrashCourseRequests.length; i++) {
          crashCourseRequests.push(tempCrashCourseRequests[i])
        }

        tempCrashCourseAccepted.sort(sortItems);

        for (var i = 0; i < tempCrashCourseAccepted.length; i++) {
          crashCourseAccepted.push(tempCrashCourseAccepted[i])
        }

        // If requests exist then create the table showing all their details and set up the buttons
        if (crashCourseRequests.length > 1) {
          // Create table rows and cells from the 2D array
          for (var i = 0; i < crashCourseRequests.length; i++) {
            var row = crashCourseTableElement.insertRow();
            for (var j = 0; j < crashCourseRequests[0].length; j++) {
              var cell = row.insertCell();
              if (j != crashCourseRequests[0].length - 1 || i == 0) {
                cell.innerHTML = crashCourseRequests[i][j];
              } else {
                cell.innerHTML = i;
              }
            }
          }
        } else {
          crashCourseTableContainerElement.style.display = "none";
          crashCourseTableTextElement.textContent = "No booking requests";
        }

        // If accepted bookings exist then create the table showing all their details and set up the buttons
        if (crashCourseAccepted.length > 1) {
          // Create table rows and cells from the 2D array
          for (var i = 0; i < crashCourseAccepted.length; i++) {
            var row = crashCourseChangeTableElement.insertRow();
            for (var j = 0; j < crashCourseAccepted[0].length; j++) {
              var cell = row.insertCell();
              if (j != crashCourseAccepted[0].length - 1 || i == 0) {
                cell.innerHTML = crashCourseAccepted[i][j];
              } else {
                cell.innerHTML = i;
              }
            }
          }
        } else {
          crashCourseChangeTableContainerElement.style.display = "none";
          crashCourseChangeTableTextElement.textContent = "No accepted bookings coming up";
        }
      })

    testAssessmentAcceptButton.addEventListener("click", testAssessmentAcceptBooking);
    testAssessmentRejectButton.addEventListener("click", testAssessmentRejectBooking);

    testAssessmentChangeButton.addEventListener("click", testAssessmentChangeToRejectBooking);

    testAssessmentCreateBookingButton.addEventListener("click", testAssessmentProcessInputs);

    testAssessmentAddListButtonElement.addEventListener("click", testAssessmentAddList);

    crashCourseAcceptButton.addEventListener("click", crashCourseAcceptBooking);
    crashCourseRejectButton.addEventListener("click", crashCourseRejectBooking);

    crashCourseChangeButton.addEventListener("click", crashCourseChangeToRejectBooking);

    crashCourseCreateBookingButton.addEventListener("click", crashCourseProcessInputs);

    crashCourseAddListButtonElement.addEventListener("click", crashCourseAddList);
  </script>
</body>

</html>